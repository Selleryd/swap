\<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SWAP — Switch With Any Portion</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <canvas id="bg"></canvas>

  <!-- Splash -->
  <main id="splash" class="splash">
    <div class="splashCard">
      <div class="logoWrap">
        <img class="logo" alt="SWAP" src="https://cdn.shopify.com/s/files/1/0550/0659/3185/files/Swap_logo_1.jpg?v=1766691390" />
      </div>

      <h1>Switch With Any Portion</h1>
      <p class="sub">
        Precision food swaps at any portion size — database-backed matching with strict tolerance logic.
      </p>

      <div class="pillRow">
        <div class="pill">
          <span class="dot" id="apiDot"></span>
          <span id="apiText">API: checking…</span>
        </div>
        <button class="iconBtn" id="apiRetry" title="Retry">
          ↻
        </button>
      </div>

      <div class="featureGrid">
        <div class="feature">
          <div class="kicker">Medical-grade</div>
          <div class="title">Deterministic exchange math</div>
          <div class="desc">Strict mode returns swaps only if they meet your tolerance. No guessing.</div>
        </div>
        <div class="feature">
          <div class="kicker">Flexible</div>
          <div class="title">Flex mode for best-fit</div>
          <div class="desc">If you allow it, see top matches ranked by nutrition error.</div>
        </div>
        <div class="feature">
          <div class="kicker">Fast</div>
          <div class="title">Search → portion → swaps</div>
          <div class="desc">Works with your Foods sheet (USDA + OFF) and scales over time.</div>
        </div>
      </div>

      <div class="ctaRow">
        <button class="btn primary" id="enterBtn">Enter now</button>
        <button class="btn ghost" id="demoBtn">Open demo</button>
      </div>

      <div class="fineprint">
        Strict mode: no match = no swaps. Flex mode: ranked best-fit (clearly labeled).
      </div>
    </div>
  </main>

  <!-- HUD -->
  <section id="app" class="app hidden">
    <aside class="side">
      <div class="brand">
        <img class="brandLogo" alt="SWAP" src="https://cdn.shopify.com/s/files/1/0550/0659/3185/files/Swap_logo_1.jpg?v=1766691390" />
        <div>
          <div class="brandName">SWAP</div>
          <div class="brandSub">Switch With Any Portion</div>
        </div>
      </div>

      <div class="pillRow hudPill">
        <div class="pill">
          <span class="dot" id="apiDot2"></span>
          <span id="apiText2">API: checking…</span>
        </div>
        <button class="iconBtn" id="apiRetry2" title="Retry">↻</button>
      </div>

      <nav class="nav">
        <button class="navItem active" data-tab="targets">Targets</button>
        <button class="navItem" data-tab="swap">Swap Engine</button>
        <button class="navItem" data-tab="notes">Notes</button>
      </nav>

      <div class="sideFooter">
        <button class="btn tiny" id="backToSplash">← Back</button>
      </div>
    </aside>

    <main class="main">
      <!-- Targets -->
      <section class="tab" id="tab-targets">
        <header class="topbar">
          <div>
            <div class="title">Targets</div>
            <div class="subtitle">Compute BMR/TDEE + macro targets (Mifflin–St Jeor).</div>
          </div>
          <div class="topActions">
            <button class="btn ghost" id="demoToggle">Demo mode</button>
            <button class="btn primary" id="computeBtn">Compute targets</button>
          </div>
        </header>

        <div class="grid2">
          <div class="card">
            <div class="cardHead">
              <div>
                <div class="cardTitle">Inputs</div>
                <div class="cardSub">Height, weight, age, sex, activity, goal</div>
              </div>
              <span class="badge">Precision</span>
            </div>

            <div class="formGrid">
              <label>Height
                <div class="fieldRow">
                  <input id="height" type="number" value="170" />
                  <span class="unit">cm</span>
                </div>
              </label>

              <label>Weight
                <div class="fieldRow">
                  <input id="weight" type="number" value="70" />
                  <span class="unit">kg</span>
                </div>
              </label>

              <label>Age
                <div class="fieldRow">
                  <input id="age" type="number" value="32" />
                  <span class="unit">yrs</span>
                </div>
              </label>

              <label>Sex
                <select id="sex">
                  <option>Male</option>
                  <option>Female</option>
                </select>
              </label>

              <label>Activity
                <select id="activity">
                  <option value="1.2">Low</option>
                  <option value="1.375">Light</option>
                  <option value="1.55">Moderate</option>
                  <option value="1.725" selected>High</option>
                  <option value="1.9">Athlete</option>
                </select>
              </label>

              <label>Goal
                <select id="goal">
                  <option value="maintain" selected>Maintain</option>
                  <option value="cut">Fat loss</option>
                  <option value="bulk">Muscle gain</option>
                </select>
              </label>
            </div>
          </div>

          <div class="card">
            <div class="cardHead">
              <div>
                <div class="cardTitle">Output</div>
                <div class="cardSub">BMR, TDEE, targets</div>
              </div>
              <span class="badge" id="targetsBadge">Not computed</span>
            </div>

            <div class="kpiGrid">
              <div class="kpi"><div class="k">BMR</div><div class="v" id="bmrOut">—</div><div class="s">kcal/day</div></div>
              <div class="kpi"><div class="k">TDEE</div><div class="v" id="tdeeOut">—</div><div class="s">kcal/day</div></div>
              <div class="kpi"><div class="k">Target kcal</div><div class="v" id="kcalOut">—</div><div class="s">kcal/day</div></div>
              <div class="kpi"><div class="k">Protein</div><div class="v" id="pOut">—</div><div class="s">g/day</div></div>
              <div class="kpi"><div class="k">Carbs</div><div class="v" id="cOut">—</div><div class="s">g/day</div></div>
              <div class="kpi"><div class="k">Fat</div><div class="v" id="fOut">—</div><div class="s">g/day</div></div>
            </div>

            <div class="hint">
              These targets help planning. Swaps are computed per-food, per-portion, with tolerance rules.
            </div>
          </div>
        </div>
      </section>

      <!-- Swap -->
      <section class="tab hidden" id="tab-swap">
        <header class="topbar">
          <div>
            <div class="title">Swap Engine</div>
            <div class="subtitle">Pick a food, enter portion, get equivalent swaps.</div>
          </div>
        </header>

        <div class="grid2">
          <div class="card">
            <div class="cardHead">
              <div>
                <div class="cardTitle">Food + filters</div>
                <div class="cardSub">Search your Foods database</div>
              </div>
              <span class="badge">Strict by default</span>
            </div>

            <label>Food search</label>
            <div class="searchRow">
              <input id="q" placeholder="e.g., chicken breast" />
              <button class="btn tiny ghost" id="clearFood">Clear</button>
            </div>
            <div id="results" class="results hidden"></div>

            <div class="formGrid2">
              <label>Portion
                <input id="portion" type="number" value="2" />
              </label>
              <label>Unit
                <select id="unit">
                  <option value="g">g</option>
                  <option value="oz" selected>oz</option>
                  <option value="serving">serving</option>
                  <option value="piece">piece</option>
                </select>
              </label>
              <label>Diet (optional)
                <select id="diet">
                  <option value="">—</option>
                  <option value="vegan">Vegan</option>
                  <option value="vegetarian">Vegetarian</option>
                  <option value="kosher">Kosher</option>
                </select>
              </label>
              <label>Medical (optional)
                <select id="medical">
                  <option value="">—</option>
                  <option value="low_sodium">Low sodium</option>
                  <option value="low_carb">Low carb</option>
                </select>
              </label>
              <label>Allergies (comma separated)
                <input id="allergies" placeholder="e.g., dairy, gluten, soy" />
              </label>
              <label>Mode
                <select id="mode">
                  <option value="strict" selected>Strict</option>
                  <option value="flex">Flex</option>
                </select>
              </label>
              <label>Cal tolerance
                <select id="calTol">
                  <option value="2">±2%</option>
                  <option value="5" selected>±5%</option>
                  <option value="10">±10%</option>
                </select>
              </label>
              <label>Macro tolerance
                <select id="macroTol">
                  <option value="5">±5%</option>
                  <option value="10" selected>±10%</option>
                  <option value="15">±15%</option>
                </select>
              </label>
            </div>

            <button class="btn primary full" id="swapBtn" disabled>Find swaps</button>

            <div class="mini" id="selectedFood">No food selected</div>
          </div>

          <div class="card">
            <div class="cardHead">
              <div>
                <div class="cardTitle">Results</div>
                <div class="cardSub">Portion suggestions + error percent</div>
              </div>
              <span class="badge" id="swapBadge">—</span>
            </div>

            <div id="swapMeta" class="mini"></div>
            <div id="swapList" class="swapList"></div>
          </div>
        </div>
      </section>

      <!-- Notes -->
      <section class="tab hidden" id="tab-notes">
        <header class="topbar">
          <div>
            <div class="title">Notes</div>
            <div class="subtitle">How this MVP behaves (so results stay “clinical”).</div>
          </div>
        </header>

        <div class="card">
          <div class="notes">
            <p><b>Core rule:</b> swaps are generated by matching calories and verifying macro tolerance.</p>
            <p><b>Strict mode:</b> if a candidate doesn’t meet tolerance, it will not appear.</p>
            <p><b>Missing columns:</b> GI/GL/satiety/insulin scores can be blank or 0 — MVP swaps only require calories + macros per gram.</p>
            <p><b>Diet/allergy filters:</b> for MVP these rely on diet_tags_json and allergens_json in your Foods sheet. If those are empty, filtered searches may exclude items (safer behavior).</p>
          </div>
        </div>
      </section>
    </main>
  </section>

  <div id="toast" class="toast hidden"></div>

  <script src="app.js"></script>
</body>
</html>

